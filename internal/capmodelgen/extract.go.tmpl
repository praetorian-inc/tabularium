// Code generated by capmodelgen; DO NOT EDIT.

package {{.Package}}

import (
	"fmt"

	"github.com/praetorian-inc/tabularium/pkg/model/model"
	"github.com/praetorian-inc/tabularium/pkg/registry"
)

func init() {
{{- range .TypeSpecs}}
	registry.Registry.MustRegisterExtractor("{{.Name}}", extract{{.Name}})
{{- end}}
}
{{range .TypeSpecs}}
func extract{{.Name}}(m registry.Model) (any, error) {
	src, ok := m.(*model.{{.SourceTypeName}})
	if !ok {
		return nil, fmt.Errorf("extract{{.Name}}: expected *model.{{.SourceTypeName}}, got %T", m)
	}
	result := {{.Name}}{
{{- range .Fields}}
{{- if .SourceGoType}}
		{{.GoFieldName}}: {{.GoType}}(src.{{.SourceFieldName}}),
{{- else}}
		{{.GoFieldName}}: src.{{.SourceFieldName}},
{{- end}}
{{- end}}
	}
{{- if .Parent}}
{{- if .Parent.Wrap}}
	if src.{{.Parent.SourceFieldName}}.Model != nil {
		p, err := registry.Registry.Extract("{{.Parent.EmbedType}}", src.{{.Parent.SourceFieldName}}.Model)
		if err != nil {
			return nil, err
		}
		typed, ok := p.(*{{.Parent.EmbedType}})
		if !ok {
			return nil, fmt.Errorf("extract{{.Name}}: parent is %T, not *{{.Parent.EmbedType}}", p)
		}
		result.{{.Parent.GoFieldName}} = *typed
	}
{{- else}}
	if src.{{.Parent.SourceFieldName}} != nil {
		p, err := registry.Registry.Extract("{{.Parent.EmbedType}}", src.{{.Parent.SourceFieldName}})
		if err != nil {
			return nil, err
		}
		typed, ok := p.(*{{.Parent.EmbedType}})
		if !ok {
			return nil, fmt.Errorf("extract{{.Name}}: parent is %T, not *{{.Parent.EmbedType}}", p)
		}
		result.{{.Parent.GoFieldName}} = *typed
	}
{{- end}}
{{- end}}
	return &result, nil
}
{{end}}
